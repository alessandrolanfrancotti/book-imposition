// ... (mantiene il resto del codice uguale, sostituisci solo la funzione draw dentro il ciclo)

                    const draw = (idx, side) => {
                        if (idx >= embeddedPages.length) return; 
                        const p = embeddedPages[idx];
                        
                        // Calcoliamo l'offset se il PDF originale è più grande del formato libro (es. ha i crocini)
                        // Assumiamo che il contenuto del libro sia centrato nel PDF originale
                        const offset = (p.width - bookW) / 2;

                        let x;
                        if (side === 'left') {
                            // La pagina di sinistra deve finire esattamente dove inizia il gutter centrale
                            // Quindi: Centro - Metà Gutter - Larghezza Libro - Offset Crocini
                            x = (sheetW / 2) - (gutter / 2) - bookW - offset;
                        } else {
                            // La pagina di destra deve iniziare esattamente dove finisce il gutter centrale
                            // Quindi: Centro + Metà Gutter - Offset Crocini
                            x = (sheetW / 2) + (gutter / 2) - offset;
                        }

                        const y = (sheetH - p.height) / 2;

                        // Applichiamo un "Clip" concettuale: disegniamo la pagina.
                        // I vettori che eccedono il foglio macchina verranno ignorati in stampa.
                        sheet.drawPage(p, { 
                            x: x, 
                            y: y, 
                            width: p.width, 
                            height: p.height 
                        });
                    };
